# LATS

## 概念介绍
LATS（Language Agent Tree Search）是一个将语言模型（LM）的推理、行动和规划能力统一起来的通用框架。它通过整合蒙特卡罗树搜索（MCTS），利用LM的上下文学习能力，使LM能够作为决策的代理，并通过LM驱动的价值函数和自我反思来进行高效的探索和增强决策制定。以下是LATS的关键特点和操作步骤：

### 关键特点

1. **推理、行动和规划的整合**：LATS通过扩展现有的ReAct方法，将推理和行动步骤的组合空间进行搜索，从而实现推理、行动和规划的统一。
2. **利用外部反馈**：LATS引入了一个环境，用于提供外部的反馈，从而超越了现有技术的限制，实现更为深思熟虑的适应性问题解决机制。
3. **自我反思和自我一致性**：LATS通过引入自我反思和自我一致性的启发式方法来指导搜索过程，从而提高模型的灵活性和适应性。

### 操作步骤

1. **选择（Selection）**：从根节点（初始状态）开始，每一层选择一个子节点，直到达到叶节点。选择过程使用UCT算法，平衡探索和利用。
2. **扩展（Expansion）**：在选择的节点处，通过从LM中采样多个动作来扩展树，并将环境反馈作为观察结果，添加新的子节点到树中。
3. **评估（Evaluation）**：为每个新节点分配一个标量值，以量化代理完成任务的进展。这个值由两个部分组成：自生成的LM评分和自一致性评分。
4. **模拟（Simulation）**：从当前选择的节点开始，模拟直到达到终端状态。在每个深度级别，优先选择最高值的节点进行扩展。
5. **回传（Backpropagation）**：根据模拟结果更新树中的节点值，以反映路径上的回报。
6. **反思（Reflection）**：对于未成功的终端节点，LM会生成一个自我反思，总结错误并提出更好的替代方案。这些反思会作为附加上下文存储在长期记忆中，用于后续迭代中改进决策过程。

### 实验结果

LATS在多种领域的实验（如编程、互动问答、网页导航和数学）中验证了其有效性和通用性，表现出较现有方法更为优越的推理和决策性能。例如，在编程任务中，LATS在HumanEval上达到了92.7%的Pass@1准确率，并且在WebShop上展示出与基于梯度的微调相当的无梯度性能。

### 总结

LATS是第一个将推理、行动和规划能力统一起来的框架，通过整合MCTS和LM的上下文学习能力，实现了更为灵活和适应性的自动化问题解决方法。通过实验验证，LATS在多个领域都表现出了卓越的性能，证明了其作为通用决策代理的潜力。



## 示例

好的，我来举一个具体的例子来说明LATS（Language Agent Tree Search）是如何工作的。假设我们有一个包含两个步骤的问题：找到一篇维基百科文章中的信息，然后用该信息回答一个问题。

### 例子：回答多跳问答任务

#### 问题
“亚瑟的杂志和《女性为先》杂志哪个创办时间更早？”

#### 操作步骤

1. **初始化**
   - 初始状态：问题是“亚瑟的杂志和《女性为先》杂志哪个创办时间更早？”
   - LATS选择开始搜索“亚瑟的杂志”。

2. **选择（Selection）**
   - 从根节点（初始状态）开始，LATS选择第一个要扩展的节点，即搜索“亚瑟的杂志”。

3. **扩展（Expansion）**
   - LATS执行搜索动作：`Search[亚瑟的杂志]`
   - 环境返回结果：`亚瑟的杂志是一份在19世纪费城出版的美国文学期刊。它由蒂莫西·谢伊·亚瑟编辑，刊登了埃德加·爱伦·坡等人的作品。1846年5月，它并入《戈迪女士图书》。
   - LATS将上述观察结果作为节点扩展到树中。

4. **评估（Evaluation）**
   - LATS基于返回的环境结果使用LM进行评估，并给出一个分数（例如，假设LM给出的分数为8，因为信息看起来是有用的）。

5. **模拟（Simulation）**
   - LATS评估这个搜索路径，看它是否需要进一步的动作。例如，此时可以继续搜索另一个杂志。

6. **选择下一个节点**
   - 下一个节点，LATS选择搜索“《女性为先》杂志”。

7. **扩展（Expansion）**
   - LATS执行搜索动作：`Search[女性为先]`
   - 环境返回结果：“《女性为先》是由Bauer Media Group在美国出版的一本女性杂志。该杂志创办于1989年，总部位于新泽西州的恩格尔伍德悬崖。”
   - LATS将上述观察结果作为节点扩展到树中。

8. **评估（Evaluation）**
   - LATS基于返回的环境结果再次使用LM进行评估，并给出一个分数（例如，LM给出的分数为9，因为信息直接回答了问题）。

9. **反思（Reflection）**
   - LATS会检查这些步骤是否能回答问题，如果不行，会生成自我反思，并在下一次尝试中使用它。

10. **完成任务**
    - LATS根据评估结果，得出结论：“亚瑟的杂志创办于19世纪，女性为先杂志创办于1989年，因此亚瑟的杂志创办时间更早。”

#### 最终回答
“亚瑟的杂志创办时间更早。”

通过这个例子可以看出，LATS通过扩展搜索树并利用环境反馈和自我反思，逐步推理和行动，最终得出正确答案。这种方法不仅考虑了当前的决策，还规划了未来的几步，以确保答案的正确性和全面性。

