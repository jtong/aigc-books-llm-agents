## 什么是 Agents

**Agents (代理)** 也称为LLM-based Agents、LLM Agents、AI Agents，是指由语言模型驱动的实体，它们能够在多次迭代中规划和采取行动以实现目标。AI代理架构可以由一个单代理或多个代理共同组成，以解决问题。通常，每个代理都有一个角色，并可以访问各种工具，这些工具将帮助它们独立完成工作或作为团队的一部分。一些代理还包含一个记忆组件，可以在消息和提示之外保存和加载信息。在本书中，我们遵循“脑、感知和行动”的代理定义。这些组件满足代理理解、推理和对环境采取行动的最低要求。

### 代理的功能

- **规划**: 制定计划以实现目标。
- **推理**: 进行复杂的思考和决策。
- **行动**: 实施计划，通过调用工具或执行任务来实现目标。

### 核心组件

一个典型的单代理通常包括以下核心组件：

- **用户请求（User Request）**：用户提出的问题或请求。
- **代理/大脑（Agent/Brain）**：代理核心，作为协调者。
- **规划（Planning）**：帮助代理规划未来的行动步骤。
- **记忆（Memory）**：管理代理的过去行为记录。
- **工具（Tools）**：一组能够与外部环境交互的工具。

### “脑、感知和行动”的Agent定义

“脑、感知和行动”的定义是从人工智能和机器人学中借用的一个概念框架。这个框架通常用于描述智能系统的基本组成部分，使其能够感知环境、进行决策和采取行动。虽然具体的术语可能有所不同，但这一概念在许多AI和机器人研究中都是通用的。这个框架将AI代理分为三个主要组成部分：脑、感知和行动，每个部分分别承担不同的任务和功能。具体解释如下：

1. **脑（Brain）**：
   - **定义**：代理的核心部分，通常由大规模语言模型（LLM）组成。
   - **功能**：负责存储记忆、处理信息、做出决策、推理和规划。类似于人类的大脑，它是代理展示智能行为的关键因素。
   - **工作机制**：在接收到感知模块传递的信息后，大脑模块进行知识检索和处理，然后根据所存储的记忆和知识进行推理和决策，生成响应或行动计划。

2. **感知（Perception）**：
   - **定义**：代理的感官系统，负责从外部环境中获取信息。
   - **功能**：将代理的感知空间从仅限文本扩展到包括文本、声音、视觉、触觉等多模态感知。这使得代理能够更全面地理解周围环境。
   - **工作机制**：感知模块接收多模态信息（如文本、图像、音频等），将其转换为代理可以理解的表示，然后传递给大脑模块进行进一步处理。

3. **行动（Action）**：
   - **定义**：代理的执行系统，负责将大脑模块生成的计划或响应付诸实施。
   - **功能**：扩展代理的行动空间，使其能够以文本输出、物理动作和工具使用等方式与环境互动，以响应环境变化并提供反馈。
   - **工作机制**：行动模块接收大脑模块传递的行动序列或指令，然后执行相应的操作，如生成文本响应、控制机器人动作或调用特定工具。

这三个核心组件是使代理理解、推理和对环境采取行动的最低要求。这个框架的设计灵感来自于人类的生物结构和认知过程，意在创建一个能够自主感知、思考和行动的智能代理系统。通过这种框架，代理可以在复杂的环境中表现出更高的适应性和智能行为。

## LLM 代理架构

根据代理数量和任务复杂性，代理架构可以分为单代理架构和多代理架构。

### 单代理架构 (Single Agent Architecture)

**单代理架构 (Single Agent Architecture)** 是一种由一个语言模型驱动的系统，独立执行所有的推理、规划和工具调用。单代理架构的主要特点包括：

- **独立性**：在单代理架构中，只有一个代理负责所有任务的执行，没有其他AI代理的反馈机制。
- **系统提示**：代理被赋予系统提示和完成任务所需的工具。
- **人类反馈**：可能会有选项允许人类提供反馈以指导代理。

单代理架构在任务明确且不需要复杂协作时表现出色，例如简单的功能调用或不需要其他代理反馈的任务。常见的单代理方法包括 ReAct、RAISE、Reflexion、AutoGPT + P 和 LATS，它们强调在采取行动之前进行推理和规划，以确保任务顺利完成。

### 多代理架构 (Multi-Agent Architecture)

**多代理架构 (Multi-Agent Architecture)** 涉及两个或更多代理，每个代理可以使用相同的语言模型或一组不同的语言模型。多代理架构的主要特点包括：

- **协作性**：多个代理可以协同工作，每个代理有自己的角色和工具。
- **通信**：代理之间可以通过共享消息和信息进行沟通。
- **动态团队**：代理团队可以根据任务需求动态调整，添加或移除代理。

多代理架构在需要协作和多条独特执行路径的复杂任务中表现出色。多代理系统可以在任何复杂程度上有各种组织，并且能够通过并行任务和稳健性来提高效率和准确性。常见的多代理架构包括具身LLM代理 (Embodied LLM Agents)、DyLAN、AgentVerse 和 MetaGPT。根据代理数量和任务复杂性，这些多代理架构通常分为两类主要的形式：垂直架构和水平架构。这两个类别代表了光谱的两端，大多数现有架构都介于这两个极端之间。

### 垂直架构与水平架构 (Vertical Architecture and Horizontal Architecture)

**垂直架构 (Vertical Architecture)** 和 **水平架构 (Horizontal Architecture)** 是多代理架构的两种具体组织形式。

- **垂直架构 (Vertical Architecture)**：
  - **领导代理**：一个代理充当领导者，其他代理直接向其报告。
  - **劳动分工**：有明确的劳动分工，报告代理可能仅与领导代理沟通。
  - **层级结构**：这种架构具有明显的层级结构，领导代理在合作代理之间分配任务并整合结果。

垂直架构的定义特征是拥有一个领导代理和在合作代理之间明确的劳动分工。这种结构适用于需要集中决策和明确分工的任务。

- **水平架构 (Horizontal Architecture)**：
  - **平等地位**：所有代理被视为平等，并且是任务组讨论的一部分。
  - **共享通信**：代理之间的通信发生在一个共享的线程中，每个代理可以看到其他所有代理的消息。
  - **协作决策**：代理自愿完成任务或调用工具，不需要由领导代理分配任务。

水平架构适用于需要大量协作、反馈和组讨论的任务，这些任务的成功依赖于代理间的紧密合作和信息共享。

#### 在具体架构中的应用

1. **具身LLM代理 (Embodied LLM Agents)**：
   - **主要特点**：通常采用垂直架构，但如果任务需要多个代理的协作和反馈，可能会引入水平通信的元素。例如，领导代理在初始阶段制定计划，随后在执行阶段允许其他代理平等交流和协作。

2. **DyLAN (Dynamic LLM Agent Network)**：
   - **主要特点**：DyLAN 主要采用水平架构，但在任务复杂性增加时，可能会出现临时领导者来协调特定子任务。这种动态调整使得 DyLAN 架构中包含了垂直架构的元素。

3. **AgentVerse**：
   - **主要特点**：AgentVerse 本质上是一个混合架构。它包含垂直架构的元素（如招募和评估阶段的领导角色）和水平架构的元素（如协作决策和独立行动执行阶段的平等合作）。这种架构允许在不同任务阶段灵活切换通信和分工方式。

4. **MetaGPT**：
   - **主要特点**：虽然 MetaGPT 主要采用水平架构，通过结构化输出和“发布-订阅”机制减少冗余对话，但在特定任务中可能需要一个临时领导者来协调信息发布和订阅。这种机制使得 MetaGPT 具备了一定的垂直架构特性。

#### 总结

垂直架构和水平架构各有其适用的场景和优势，**垂直架构**适用于需要明确领导和分工的多代理系统，例如具身LLM代理。**水平架构**适用于需要协作和信息共享的多代理系统，例如 DyLAN 和 MetaGPT。也可以将两种架构的优点结合起来，能够更好地应对复杂任务和动态环境中的挑战，例如AgentVerse。

## 代理的角色与工具

### 角色的定义和重要性

代理角色 (Agent Persona) 是Agent设计的重要组成部分，不同角色需要具备不同的能力和行为模式。角色的定义不仅影响Agent的行为逻辑，还决定了Agent在特定任务中的表现。通过明确角色，Agent能够在复杂环境中做出更合适的决策，从而提高任务完成的效率和准确性。

### 角色定义的要素

论文中提到，代理角色的定义包括以下几个方面：

1. **任务描述**：
   - 每个代理角色都有一个明确的任务描述，定义其在系统中的主要职责。
   - 示例：一个代理可能负责数据收集，另一个代理可能负责数据分析。

2. **工具访问**：
   - 代理角色定义了代理可以访问的工具和功能。这些工具可以是内部系统功能，也可以是外部API。这些工具和功能帮助代理在其职责范围内完成任务。
   - 示例：合同撰写代理有权使用文档编辑工具、法律数据库和电子邮件发送工具。

3. **个性与行为**：
   - 角色定义还包括代理的个性特征和行为模式。这些特征和行为模式有助于代理在特定情境下做出合适的反应。 
   - 示例：客服代理被设计为友好和耐心，以处理客户询问和投诉。而一个销售代理可能被设计为积极和说服力强。

#### 示例说明

以下是论文中的具体示例，展示了如何通过角色定义权限与范围：

1. **合同撰写代理 (Contract Writer Agent)**：
   - **任务描述**：撰写和审核合同。
   - **工具访问**：文档编辑工具、法律数据库、电子邮件发送工具。
   - **个性与行为**：精确、注重细节、遵循法律规范。

2. **客服代理 (Customer Support Agent)**：
   - **任务描述**：处理客户询问和投诉。
   - **工具访问**：客户关系管理系统、问题跟踪工具、即时通讯工具。
   - **个性与行为**：友好、耐心、问题解决导向。

3. **数据分析代理 (Data Analyst Agent)**：
   - **任务描述**：收集和分析数据，生成报告。
   - **工具访问**：数据分析工具、报告生成工具、数据可视化工具。
   - **个性与行为**：分析性思维、数据驱动、精准。

### 角色定义的实现策略

根据论文中的内容，定义和实现Agent角色的策略主要有以下几种：

#### 1. **手工定义**
通过手工定义角色的身份、性格和社交信息，明确角色的行为模式。例如，
- **Generative Agent**通过手工设定角色的姓名、目标和关系来定义角色。
- **MetaGPT**和**ChatDev**通过预定义各个角色及其职责，来实现软件开发中的角色分工。

#### 2. **利用LLM生成**
利用LLM生成Agent的角色信息，减少人工工作量。例如，
- **RecAgent**首先手工创建部分种子角色信息，然后利用ChatGPT生成更多角色信息。

#### 3. **数据集对齐**
通过从真实世界数据集中提取角色信息，使Agent的行为更贴近现实。例如，
- **Out of One, Many**中的Agent基于美国国家选举研究（ANES）中的人口背景信息来定义角色。

### 角色对其他模块的影响

角色定义不仅决定了Agent的行为，还会影响记忆、计划和行动模块。例如，
- **记忆模块**需要根据角色的不同，存储和检索不同类型的记忆信息。
- **计划模块**需要考虑角色的目标和能力，制定合理的任务计划。
- **行动模块**需要根据角色的身份和任务目标，采取合适的行动策略。

## 推理与规划

AI代理（Agents）的推理与规划在实现其目标时扮演了至关重要的角色。智能体（Agents）被认为是能够通过感知环境、规划和执行动作来完成特定任务的智能实体。规划是智能体最关键的能力之一，需要复杂的理解、推理和决策过程。

### 推理的重要性

**推理**是人类认知的重要构建块，它使人们能够做出决策、解决问题并理解周围的世界。对于AI代理来说，强大的推理能力是必不可少的，因为它们需要在复杂的环境中进行交互、做出自主决策，并在各种任务中帮助人类。推理能力的几个关键点包括：

- **理解和分析**：通过分析任务和环境，从中提取有用信息，理解其要求和限制。
- **逻辑判断**：基于已有的知识和信息，进行逻辑判断和推断。
- **决策制定**：在多种可能的行动路径中，通过推理选择最优的决策。
- **多步推理**：代理需要能够处理多步操作，考虑每一步的影响，并在整个决策过程中保持一致性。
- **动态调整**：根据新信息和反馈，实时调整决策。
- **应对不确定性**：在面对未知或不完全信息时，代理必须能够进行推理以做出合理的决策，确保任务的顺利进行。

推理的核心是通过认知和逻辑过程来确保代理的行为符合任务要求，并能够灵活应对环境变化。

### 规划的重要性

**规划**是基于强大推理能力的一个重要步骤，通常涉及以下几种方法：

1. **任务分解**：将一个复杂任务分解为多个子任务。
2. **步骤设计**：为每个子任务设计具体的执行步骤和顺序。
3. **资源分配**：合理分配和利用可用资源（如工具、时间和计算能力），提高整体效率。
4. **路径优化**：在多个可能的执行路径中，选择最优路径以提高任务成功率。或从生成的多个计划选项中选择一个最优方案。
5. **反思与改进**：基于新信息修改先前的计划，或利用外部信息或记忆来改进计划。

大多数代理模式都会有一个专门的规划步骤，在执行任何操作之前调用这些技术之一或多个来创建计划。

### 推理与规划的结合

推理和规划的紧密结合使得代理能够更加有效地解决复杂问题。通过推理，代理能够理解任务的要求和环境的变化，并在此基础上进行规划。有效的规划则可以将复杂任务分解为可管理的部分，并选择最优的执行路径。

### 现有方法的分类

现有的LLM-Agent规划方法主要分为以下五类：

1. **任务分解（Task Decomposition）**：将复杂任务分解为多个子任务，分别进行规划。任务分解方法主要有两类：先分解后规划（Decomposition-First）和交替分解与规划（Interleaved Decomposition）。
2. **多计划选择（Multi-plan Selection）**：生成多个候选计划，选择最优的执行。常见的方法包括自一致性（Self-consistency）、计划树（Tree-of-Thought）和蒙特卡洛树搜索（MCTS）。
3. **外部规划器辅助（External Planner-Aided Planning）**：使用外部规划器提高规划效率和可行性。例如，结合符号规划器和神经规划器，利用LLM的编码能力将任务转化为符号语言，使用外部规划器进行高效规划，如PDDL语言的LLM+P方法，和使用神经规划器的SwiftSage方法。
4. **反思与改进（Reflection and Refinement）**：通过反思和总结失败经验改进规划能力。代表方法包括Self-refine和Reflexion。
5. **记忆增强规划（Memory-augmented Planning）**：利用额外的记忆模块存储和检索有价值的信息辅助规划。RAG技术通过检索相关信息辅助生成，嵌入记忆则通过微调模型参数将历史经验嵌入模型中。

### 推理与规划的具体方法

**ReAct**（Reason + Act）方法：代理首先对给定任务写下一个想法，然后基于该想法执行一个动作，并观察输出。这个循环可以重复直到任务完成。ReAct 方法展示了在多样的语言和决策任务中比零次提示更高的有效性。

**RAISE** 方法：在 ReAct 方法的基础上增加了记忆机制，模拟人类的短期和长期记忆。通过使用便笺本进行短期存储，并使用类似的先前示例数据集进行长期存储来实现。这提高了代理在更长对话中保持上下文的能力。

**Reflexion** 方法：使用语言反馈进行自我反思，通过利用成功状态、当前轨迹和持久记忆等指标，提供具体和相关的反馈，从而提高成功率并减少幻觉。

### 未来方向

尽管这些方法在提升规划能力方面取得了进展，但仍存在一些挑战，例如幻觉问题、生成计划的可行性和效率、多模态环境反馈的处理以及细粒度评估等。未来的研究可能会结合符号AI和统计AI的发展，设计更现实的评估环境，进一步提升智能体的规划和推理能力。

